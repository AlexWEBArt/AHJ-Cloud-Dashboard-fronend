(()=>{"use strict";class e{constructor(e,t){this.URL=e,this.container=t}conectingToWS(t){const n=new WebSocket(`wss://${this.URL}/ws`),o=Array.from(document.querySelectorAll(".instance-id")).find((e=>e.textContent===t)).closest(".instance-container"),s=o.querySelector(".instance-status");o.querySelector(".action-playback").addEventListener("click",(()=>{const e={};e.id=t,"Stopped"===s.textContent?e.status="running":e.status="stopped",n.send(JSON.stringify(e))})),n.addEventListener("open",(e=>{console.log(e),console.log("ws open")})),n.addEventListener("close",(e=>{console.log(e),console.log("ws close")})),n.addEventListener("error",(e=>{console.log(e),console.log("ws error")})),n.addEventListener("message",(t=>{const n=JSON.parse(t.data);console.log(n[0]),n[0].id&&(n.forEach((t=>{const n=t.id,{state:o}=t;e.updateInstance(n,o)})),console.log("ws message"))}))}static updateInstance(e,t){const n=Array.from(document.querySelectorAll(".instance-id")).filter((t=>t.textContent===e))[0];"running"===t?(n.closest(".instance-column").querySelector(".instance-status").textContent="Running",n.closest(".instance-column").querySelector(".instance-status-image").textContent="ðŸŸ¢",n.closest(".instance-column").querySelector(".action-playback").textContent="â¸"):(n.closest(".instance-column").querySelector(".instance-status").textContent="Stopped",n.closest(".instance-column").querySelector(".instance-status-image").textContent="âš«",n.closest(".instance-column").querySelector(".action-playback").textContent="â–¶")}renderInstance(e){const t=document.createElement("DIV"),n=document.createElement("UL"),o=document.createElement("LI"),s=document.createElement("P"),a=document.createElement("LI"),c=document.createElement("UL"),d=document.createElement("LI"),i=document.createElement("P"),r=document.createElement("LI"),l=document.createElement("P"),p=document.createElement("LI"),m=document.createElement("P"),u=document.createElement("LI"),g=document.createElement("UL"),L=document.createElement("LI"),E=document.createElement("P"),h=document.createElement("LI"),w=document.createElement("P"),y=document.createElement("LI"),S=document.createElement("P");t.classList.add("instance-container"),n.classList.add("instance-column"),s.classList.add("instance-id"),c.classList.add("instance-row"),g.classList.add("instance-row"),d.classList.add("title-width"),l.classList.add("instance-status-image"),m.classList.add("instance-status"),L.classList.add("title-width"),w.classList.add("action-playback"),S.classList.add("action-delete"),s.textContent=e.id,i.textContent="Status:",E.textContent="Actions:","running"===e.state?(l.textContent="ðŸŸ¢",m.textContent="Running",w.textContent="â¸"):(l.textContent="âš«",m.textContent="Stopped",w.textContent="â–¶"),S.textContent="âœ–",S.addEventListener("click",(()=>{window.api.removeInstance(e.id)})),this.container.appendChild(t),t.append(n),n.append(o),o.append(s),n.append(a),a.append(c),c.append(d),d.append(i),c.append(r),r.append(l),c.append(p),p.append(m),n.append(u),u.append(g),g.append(L),L.append(E),g.append(h),h.append(w),g.append(y),y.append(S),window.api.removeLoading(),this.conectingToWS(e.id)}}document.querySelector("body").style.backgroundImage="url(assets/253f7b15dd6eb9ac37984ada287333f9.jpg)";const t="cloud-dashboard-backend.onrender.com/",n=document.querySelector(".instances-box"),o=document.querySelector(".logs-box"),s=new e(t,n),a=new class{constructor(e,t){this.container=e,this.instanceFactory=t}connectingToSSE(e){const t=new EventSource(`https://${e}sse`);t.addEventListener("open",(e=>{console.log(e),console.log("sse open")})),t.addEventListener("error",(e=>{console.log(e),console.log("sse error")})),t.addEventListener("message",(e=>{console.log(e);const t=JSON.parse(e.data);if(this.renderLog(t),"Created"===t.info){const e={id:t.id,state:"stopped"};this.instanceFactory.renderInstance(e)}"Removed"===t.info&&Array.from(document.querySelectorAll(".instance-id")).filter((e=>e.textContent===t.id))[0].closest(".instance-container").remove(),console.log("sse message")}))}renderLog(e){const t=document.createElement("DIV"),n=document.createElement("SPAN"),o=document.createElement("DIV"),s=document.createElement("P"),a=document.createElement("P");t.classList.add("log-container"),n.classList.add("log-timestamp"),o.classList.add("log-information-box"),s.classList.add("log-mark"),a.classList.add("log-message"),n.textContent=e.timeStamp,s.textContent=`Server: ${e.id}`,a.textContent=`INFO: ${e.info}`,this.container.appendChild(t),t.append(n),t.append(o),o.append(s),o.append(a)}}(o,s);window.api=new class{constructor(e,t,n){this.apiUrl=e,this.instanceFactory=t,this.containerInstances=n}async renderInstances(){this.generationLoading();const e=fetch(`https://${this.apiUrl}instances/`,{method:"GET",headers:{"Content-Type":"application/json"}}),t=await e;t.ok?((await t.json()).data.forEach((e=>{this.instanceFactory.renderInstance(e)})),this.removeLoading()):console.error("ÐžÑˆÐ¸Ð±ÐºÐ°")}async addInstance(){fetch(`https://${this.apiUrl}addInstance/`,{method:"GET",headers:{"Content-Type":"application/json"}})}async removeInstance(e){this.generationLoading();const t=`removeInstance/?id=${encodeURIComponent(e)}`,n=fetch(`https://${this.apiUrl+t}`,{method:"DELETE",headers:{"Content-type":"application/x-www-form-urlencoded"}});(await n).ok||console.error("ÐžÑˆÐ¸Ð±ÐºÐ°!"),this.removeLoading()}generationLoading(){if(!document.querySelector(".loadingio-spinner-spinner-ugc4sg2wum")){const e=document.createElement("DIV"),t=document.createElement("DIV");e.classList.add("loadingio-spinner-spinner-ugc4sg2wum"),t.classList.add("ldio-7nr8cpu8w2k"),this.containerInstances.appendChild(e),e.append(t);for(let e=12;0!==e;e-=1)t.append(document.createElement("DIV"))}}removeLoading(){document.querySelector(".loadingio-spinner-spinner-ugc4sg2wum")&&this.containerInstances.querySelector(".loadingio-spinner-spinner-ugc4sg2wum").remove()}}(t,s,n),a.connectingToSSE(t);const c=document.querySelector(".new-instance");window.api.renderInstances(),c.addEventListener("click",(()=>{window.api.generationLoading(),window.api.addInstance()}))})();
//# sourceMappingURL=main.js.map